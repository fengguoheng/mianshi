"use strict";(self["webpackChunkavatarvue2"]=self["webpackChunkavatarvue2"]||[]).push([[955],{9955:function(e,t,s){s.r(t),s.d(t,{default:function(){return p}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"nav-container"},[t("div",{staticClass:"blog-container"},e._l(e.extractedData,(function(s){return t("div",{key:s.id,staticClass:"blog-card",on:{click:function(t){return e.goToBlogPage(s)}}},[t("div",{staticClass:"blog-header"},[t("h3",{staticClass:"blog-title"},[e._v(e._s(s.title))]),t("h4",{staticClass:"blog-author"},[e._v(e._s(s.username))]),t("span",{staticClass:"blog-date"},[e._v(e._s(e.formatDate(s.date)))])]),t("p",{staticClass:"comment-count"},[e._v("评论数量："+e._s(e.getCommentsForBlog(s.date).length))]),t("p",{staticClass:"like-count"},[e._v("点赞数量："+e._s(s.likeCount))]),t("button",{staticClass:"delete-btn",on:{click:function(t){return t.stopPropagation(),e.deleteBlog(s)}}},[e._v("删除")])])})),0),t("div",{staticClass:"fixed-button-container"},[t("button",{staticClass:"friend-btn",on:{click:e.openFriendApplyDialog}},[e._v("好友申请")])]),t("div",{staticClass:"friend-dialog",class:{show:e.showFriendApplyDialog}},[t("div",{staticClass:"dialog-header"},[e._v("好友申请")]),t("div",{staticClass:"dialog-content"},[t("ul",e._l(e.friendApplys,(function(s){return t("li",{key:s.username,staticClass:"apply-item"},[e._v(" "+e._s(s.username)+"的申请 - "+e._s(s.isReplied)+" "),t("button",{staticClass:"accept-btn",on:{click:function(t){return e.acceptFriendApply(s.username)}}},[e._v("接受")]),t("button",{staticClass:"reject-btn",on:{click:function(t){return e.rejectFriendApply(s.username)}}},[e._v("拒绝")])])})),0)])])])},r=[],n=(s(4114),s(8111),s(2489),s(1701),s(4373)),o={name:"PersonalHome",data(){return{activeIndex:"personal",sortedBlogs:[],extractedData:[],allComments:[],username:"",showFriendApplyDialog:!1,friendApplys:[]}},computed:{getCommentsForBlog(){return e=>this.allComments?this.allComments.filter((t=>t&&t.blogDate===e)):[]}},methods:{handleSelect(e){this.activeIndex=e,console.log("当前选中：",e),"home"===e&&this.$router.push("/home")},async fetchUserBlogs(){try{const e="https://tender-secure-bluegill.ngrok-free.app",t={"ngrok-skip-browser-warning":"true"},[s,a]=await Promise.all([n.A.get(`${e}/api/personBlogs/${this.username}`,{headers:t}),n.A.get(`${e}/api/getComments`,{headers:t})]);this.sortedBlogs=s.data.a,this.extractedData=this.sortedBlogs.map((e=>({date:e.date,title:e.title,content:e.content,username:e.username}))),this.allComments=a.data;const r=await Promise.all(this.extractedData.map((async e=>{const t=await this.getLikeCount(e.username,e.date);return{...e,likeCount:t}})));this.extractedData=r}catch(e){console.error("获取数据失败:",e)}},async getLikeCount(e,t){try{const s="https://tender-secure-bluegill.ngrok-free.app",a={"ngrok-skip-browser-warning":"true"},r=await n.A.get(`${s}/api/getTotallikes/${e}/${t}`,{headers:a});return r.data.number}catch(s){return console.error("获取点赞数量失败:",s),0}},goToBlogPage(e){const t=this.getCommentsForBlog(e.date),s={content:e.content,comments:t,username:e.username,date:e.date,title:e.title};localStorage.setItem("selectedBlogData",JSON.stringify(s)),this.$router.push({name:"blog"})},async deleteBlog(e){try{const t="https://tender-secure-bluegill.ngrok-free.app",s={"ngrok-skip-browser-warning":"true"},a=await n.A.delete(`${t}/api/deleteBlogsByTime`,{headers:s,data:{date:e.date}});200===a.status?this.extractedData=this.extractedData.filter((t=>t.date!==e.date)):console.error("删除博客失败，状态码:",a.status)}catch(t){console.error("删除博客失败:",t)}},formatDate(e){const t=new Date(e);t.setTime(t.getTime()+288e5);const s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0"),o=String(t.getMinutes()).padStart(2,"0"),i=String(t.getSeconds()).padStart(2,"0");return`${s}/${a}/${r} ${n}:${o}:${i}`},openFriendApplyDialog(){this.showFriendApplyDialog=!0,this.fetchFriendApplys()},async fetchFriendApplys(){try{const e="https://tender-secure-bluegill.ngrok-free.app",t={"ngrok-skip-browser-warning":"true"},s=await n.A.get(`${e}/api/getApplys/${this.username}`,{headers:t});this.friendApplys=s.data.friendApplys}catch(e){console.error("获取好友申请失败:",e)}},async acceptFriendApply(e){try{const t="https://tender-secure-bluegill.ngrok-free.app",s={"ngrok-skip-browser-warning":"true"},a=await n.A.post(`${t}/api/updateFriendApply`,{currentUsername:this.username,friendUsername:e,status:"accept"},{headers:s});200===a.status?(console.log("接受好友申请成功"),await this.fetchFriendApplys()):console.error("接受好友申请失败，状态码:",a.status)}catch(t){console.error("接受好友申请失败:",t)}},async rejectFriendApply(e){try{const t="https://tender-secure-bluegill.ngrok-free.app",s={"ngrok-skip-browser-warning":"true"},a=await n.A.post(`${t}/api/updateFriendApply`,{currentUsername:this.username,friendUsername:e,status:"reject"},{headers:s});200===a.status?(console.log("拒绝好友申请成功"),await this.fetchFriendApplys()):console.error("拒绝好友申请失败，状态码:",a.status)}catch(t){console.error("拒绝好友申请失败:",t)}}},mounted(){this.username=localStorage.getItem("username"),this.fetchUserBlogs(),this.fetchFriendApplys()}},i=o,l=s(1656),c=(0,l.A)(i,a,r,!1,null,"487be2db",null),p=c.exports}}]);
//# sourceMappingURL=955.4bd74a2a.js.map