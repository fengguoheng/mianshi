"use strict";(self["webpackChunkavatarvue2"]=self["webpackChunkavatarvue2"]||[]).push([[474],{9474:function(s,t,e){e.r(t),e.d(t,{default:function(){return d}});var a=function(){var s=this,t=s._self._c;return t("div",{staticClass:"nav-container"},[t("div",{staticClass:"container"},[t("div",{staticClass:"button-group"},[t("button",{staticClass:"custom-btn",on:{click:s.jumpToHome}},[s._v("返回首页")])]),t("div",{staticClass:"exam-container"},[t("h1",[s._v("笔试答案分析")]),t("div",{ref:"examContent",staticClass:"exam-content"},[s.isLoading?t("div",{staticClass:"loading"},[t("p",[s._v("正在加载笔试内容...")])]):t("div",{staticClass:"question-container"},s._l(s.questions,(function(e,a){return t("div",{key:a,staticClass:"question"},[t("h3",[s._v("问题 "+s._s(a+1))]),t("div",{staticClass:"question-content"},[s._v(" "+s._s(e.question)+" ")]),t("div",{staticClass:"options"},s._l(e.options,(function(e,n){return t("label",{key:n,staticClass:"option"},[t("input",{directives:[{name:"model",rawName:"v-model",value:s.answers[a],expression:"answers[index]"}],attrs:{type:"radio",name:"q"+(a+1)},domProps:{value:e.value,checked:s._q(s.answers[a],e.value)},on:{change:function(t){return s.$set(s.answers,a,e.value)}}}),s._v(" "+s._s(e.label)+". "+s._s(e.content)+" ")])})),0),t("div",{staticClass:"user-answer"},[t("p",[t("strong",[s._v("你的答案：")]),s._v(s._s(s.answers[a]||"未选择"))]),s.showAnswers?t("p",[t("strong",[s._v("正确答案：")]),s._v(s._s(e.answer))]):s._e()])])})),0)]),t("div",{staticClass:"submit-area"},[t("button",{attrs:{id:"submitBtn",disabled:s.isUploading},on:{click:s.handleUpload}},[s._v(" "+s._s(s.isUploading?"分析中...":"分析答案")+" ")]),t("button",{staticClass:"show-answer-btn",on:{click:function(t){s.showAnswers=!s.showAnswers}}},[s._v(" "+s._s(s.showAnswers?"隐藏答案":"显示答案")+" ")])]),t("div",{directives:[{name:"show",rawName:"v-show",value:s.showProgress,expression:"showProgress"}],staticClass:"progress"},[s._v(s._s(s.progressText))]),t("div",{directives:[{name:"show",rawName:"v-show",value:s.showResult,expression:"showResult"}],staticClass:"result-container"},[s.isLoadingResult?t("div",{staticClass:"loading"},[t("p",[s._v("正在生成分析报告...")])]):t("div",{staticClass:"analysis-result"},[t("h2",[s._v("笔试答案分析报告")]),t("div",{staticClass:"visualization-container"},[t("div",{staticClass:"chart-wrapper"},[t("canvas",{ref:"resultChart",attrs:{width:"400",height:"300"}})])]),t("div",{staticClass:"analysis-content",domProps:{innerHTML:s._s(s.answerHtml)}})])])])])])},n=[],i=(e(4114),e(8111),e(7588),e(1701),e(3579),e(4506)),o=e.n(i),r=e(9064),l={data(){return{questions:[],answers:[],isLoading:!0,isUploading:!1,showProgress:!1,showResult:!1,isLoadingResult:!1,progressText:"",answerContent:"",answerHtml:"",showAnswers:!1,requestId:null,apiBaseUrl:"https://117.72.49.76:443",chart:null,analysisData:{}}},mounted(){this.loadQuestions()},methods:{jumpToHome(){this.$router.push("/home")},loadQuestions(){try{const s=localStorage.getItem("question");s?this.parseQuestions(s):(this.isLoading=!1,this.questions=this.generateSampleQuestions())}catch(s){console.error("加载题目失败:",s),this.questions=this.generateSampleQuestions()}finally{this.isLoading=!1,this.answers=new Array(this.questions.length).fill("")}},generateSampleQuestions(){return[{id:1,question:"1. 下列哪个不是人工智能的主要研究领域？",options:[{label:"A",content:"机器学习",value:"A"},{label:"B",content:"自然语言处理",value:"B"},{label:"C",content:"量子计算",value:"C"},{label:"D",content:"计算机视觉",value:"D"}],answer:"C",category:"AI基础"},{id:2,question:"2. 下列哪个算法属于监督学习？",options:[{label:"A",content:"K-means",value:"A"},{label:"B",content:"决策树",value:"B"},{label:"C",content:"PCA",value:"C"},{label:"D",content:"LDA",value:"D"}],answer:"B",category:"机器学习"},{id:3,question:"3. 卷积神经网络(CNN)主要用于什么领域？",options:[{label:"A",content:"自然语言处理",value:"A"},{label:"B",content:"计算机视觉",value:"B"},{label:"C",content:"语音识别",value:"C"},{label:"D",content:"强化学习",value:"D"}],answer:"B",category:"深度学习"}]},parseQuestions(s){const t=[],e=s.split("\n");let a=null,n=[];e.forEach((s=>{const e=s.trim(),i=e.match(/^Q(\d+):$/);if(i){const s=parseInt(i[1],10);a&&(a.options=n,t.push(a),n=[]),a={id:s,question:"",options:[],answer:"",category:"未知"}}else if(e.startsWith("#分类:"))a&&(a.category=e.slice(4).trim());else if(e.startsWith("A.")||e.startsWith("B.")||e.startsWith("C.")||e.startsWith("D.")){const s=e.charAt(0),t=e.slice(2).trim();n.push({label:s,content:t,value:s})}else a&&(a.question+=e+"\n")})),a&&(a.options=n,t.push(a)),this.questions=t},async handleUpload(){if(this.answers.some((s=>!s)))alert("请回答所有问题");else{this.isUploading=!0,this.showProgress=!0,this.progressText="正在分析答案，请稍候...",this.showResult=!1,this.isLoadingResult=!1;try{const s=await o()(this.$refs.examContent,{useCORS:!0,logging:!1,scale:2,scrollX:0,scrollY:0}),t=s.toDataURL("image/png").split(",")[1];let e="生成结构化的笔试答案分析报告，要求包含以下可视化数据：\n\n";e+="1. 整体正确率统计（百分比）\n",e+="2. 按知识点分类的掌握情况（如AI基础、机器学习等），需提供分类名称和掌握分数\n",e+="3. 错误题目的详细解析（包含错误原因和知识点补充）\n",e+="4. 针对性的学习建议\n",e+="5. 结构化数据输出（JSON格式），包含以上所有内容\n\n",e+="以下是笔试题目、用户答案和正确答案：\n\n",this.questions.forEach(((s,t)=>{e+=`Q${t+1}: ${s.question}\n`,e+=`用户答案: ${this.answers[t]||"未选择"}\n`,e+=`正确答案: ${s.answer}\n`,e+=`题目分类: ${s.category}\n\n`}));const a=await fetch(`${this.apiBaseUrl}/image-understanding`,{method:"POST",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"69420"},body:JSON.stringify({image_base64:t,question:e})}),n=await a.json();"processing"===n.status?(this.requestId=n.request_id,await this.pollResult()):this.handleAnalysisResult(n)}catch(s){console.error("分析失败:",s),this.answerContent=`网络错误：${s.message}`,this.answerHtml=this.parseMarkdownToHtml(this.answerContent),this.showResult=!0}finally{this.isUploading=!1,this.showProgress=!1}}},handleAnalysisResult(s){if("failed"===s.status)return this.answerContent="分析失败："+(s.error||"未知错误"),this.answerHtml=this.parseMarkdownToHtml(this.answerContent),void(this.showResult=!0);this.answerContent=s.content||"暂无分析结果";try{const s=this.answerContent.indexOf("{"),t=this.answerContent.lastIndexOf("}")+1;if(s>0&&t>s){const e=this.answerContent.substring(s,t);this.analysisData=JSON.parse(e),this.renderVisualization()}}catch(t){console.error("解析分析结果失败:",t),this.analysisData={}}this.answerHtml=this.parseMarkdownToHtml(this.answerContent),this.showResult=!0},async pollResult(){try{while(1){const s=await fetch(`${this.apiBaseUrl}/get-result/${this.requestId}`),t=await s.json();if("completed"===t.status)return void this.handleAnalysisResult(t);if("failed"===t.status)return this.answerContent="分析失败："+(t.error||"未知错误"),this.answerHtml=this.parseMarkdownToHtml(this.answerContent),void(this.showResult=!0);await new Promise((s=>setTimeout(s,3e3))),this.progressText="分析中，请稍候..."}}catch(s){console.error("轮询失败:",s),this.answerContent=`轮询错误：${s.message}`,this.answerHtml=this.parseMarkdownToHtml(this.answerContent),this.showResult=!0}},renderVisualization(){if(!this.analysisData||!this.analysisData.categoryMastery)return;const s=this.$refs.resultChart.getContext("2d");this.chart&&this.chart.destroy();const t=Object.keys(this.analysisData.categoryMastery),e=t.map((s=>this.analysisData.categoryMastery[s].score)),a=["rgba(59, 130, 246, 0.7)","rgba(16, 185, 129, 0.7)","rgba(243, 156, 18, 0.7)","rgba(230, 126, 34, 0.7)","rgba(220, 38, 38, 0.7)"];this.chart=new r.t1(s,{type:"bar",data:{labels:t,datasets:[{label:"知识点掌握情况 (%)",data:e,backgroundColor:a,borderColor:a.map((s=>s.replace("0.7","1"))),borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,max:100,title:{display:!0,text:"掌握度"}}},plugins:{title:{display:!0,text:"各知识点掌握情况"},legend:{display:!1}}}})},parseMarkdownToHtml(s){if(!s)return"<p>暂无分析结果</p>";let t=s.replace(/\*\*(.*?)\*\*/g,"<h3>$1</h3>").replace(/^\s*-\s+(.*)$/gm,"<li>$1</li>").replace(/(<li>.*?<\/li>)/gs,"<ul>$1</ul>").replace(/\n{3,}/g,"\n\n").split("\n\n").map((s=>s.trim().startsWith("<h3>")||s.trim().startsWith("<ul>")?s:`<p>${s.trim()}</p>`)).join("");return`<div class="answer-content">${t}</div>`}},beforeDestroy(){this.chart&&this.chart.destroy()}},h=l,c=e(1656),u=(0,c.A)(h,a,n,!1,null,"b1e47e10",null),d=u.exports}}]);
//# sourceMappingURL=474.a88f9a87.js.map